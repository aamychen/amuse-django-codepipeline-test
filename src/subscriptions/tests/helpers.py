from datetime import datetime
from uuid import uuid4


def apple_notification_payload(
    expires_date=None,
    external_recurring_id='123',
    notification_type='RENEWAL',
    product_id='amuse_pro_monthly_renewal',
    auto_renew_status='true',
):
    if expires_date is None:
        expires_date = datetime.utcnow()

    return {
        "auto_renew_status_change_date": "2020-01-22 16:40:49 Etc/GMT",
        "environment": "Sandbox",
        "auto_renew_status": auto_renew_status,
        "auto_renew_status_change_date_pst": "2020-01-22 08:40:49 America/Los_Angeles",
        "latest_receipt": "...",
        "latest_receipt_info": {
            "original_purchase_date_pst": "2020-01-21 09:23:56 America/Los_Angeles",
            "quantity": "1",
            "subscription_group_identifier": "12345",
            "unique_vendor_identifier": "65BF29C9-4644-4D53-BC67-1F615B7072C4",
            "original_purchase_date_ms": "1579627436000",
            "expires_date_formatted": '2020-01-22 08:41:46 Etc/GMT',
            "is_in_intro_offer_period": "false",
            "purchase_date_ms": "1579711006000",
            "expires_date_formatted_pst": "2020-01-22 08:41:46 America/Los_Angeles",
            "is_trial_period": "false",
            "item_id": "1491033244",
            "unique_identifier": "6076286fe2d0ee4a4c988f01d9be82c990608f03",
            "original_transaction_id": external_recurring_id,
            "expires_date": str(datetime.timestamp(expires_date) * 1000),
            "transaction_id": str(uuid4()),
            "bvrs": "1",
            "web_order_line_item_id": "1000000049740294",
            "version_external_identifier": "0",
            "bid": "io.amuse.ios",
            "product_id": product_id,
            "purchase_date": "2020-01-22 16:36:46 Etc/GMT",
            "purchase_date_pst": "2020-01-22 08:36:46 America/Los_Angeles",
            "original_purchase_date": "2020-01-21 17:23:56 Etc/GMT",
        },
        "password": "26ad731a39e444c2834495e37769842c",
        "auto_renew_status_change_date_ms": "1579711249000",
        "auto_renew_product_id": "amuse_pro_monthly_renewal",
        "notification_type": notification_type,
    }


def apple_receipt_validation_response(
    expires_date,
    auto_renew_status='0',
    external_recurring_id='123',
    product_id='amuse_pro_monthly_renewal',
):
    expires_at = str(datetime.timestamp(expires_date) * 1000)
    transaction_id_1 = str(uuid4())
    transaction_id_2 = str(uuid4())
    return {
        'status': 0,
        'environment': 'Sandbox',
        'receipt': {
            'receipt_type': 'ProductionSandbox',
            'adam_id': 0,
            'app_item_id': 0,
            'bundle_id': 'io.amuse.ios',
            'application_version': '1',
            'download_id': 0,
            'version_external_identifier': 0,
            'receipt_creation_date': '2020-01-24 14:42:38 Etc/GMT',
            'receipt_creation_date_ms': '1579876958000',
            'receipt_creation_date_pst': '2020-01-24 06:42:38 America/Los_Angeles',
            'request_date': '2020-01-28 10:38:48 Etc/GMT',
            'request_date_ms': '1580207928390',
            'request_date_pst': '2020-01-28 02:38:48 America/Los_Angeles',
            'original_purchase_date': '2013-08-01 07:00:00 Etc/GMT',
            'original_purchase_date_ms': '1375340400000',
            'original_purchase_date_pst': '2013-08-01 00:00:00 America/Los_Angeles',
            'original_application_version': '1.0',
            'in_app': [
                {
                    'quantity': '1',
                    'product_id': product_id,
                    'transaction_id': transaction_id_1,
                    'original_transaction_id': external_recurring_id,
                    'purchase_date': '2020-01-21 17:23:54 Etc/GMT',
                    'purchase_date_ms': '1579627434000',
                    'purchase_date_pst': '2020-01-21 09:23:54 America/Los_Angeles',
                    'original_purchase_date': '2020-01-21 17:23:56 Etc/GMT',
                    'original_purchase_date_ms': '1579627436000',
                    'original_purchase_date_pst': '2020-01-21 09:23:56 America/Los_Angeles',
                    'expires_date': '2020-01-21 17:28:54 Etc/GMT',
                    'expires_date_ms': expires_at,
                    'expires_date_pst': '2020-01-21 09:28:54 America/Los_Angeles',
                    'web_order_line_item_id': '1000000049717223',
                    'is_trial_period': 'false',
                    'is_in_intro_offer_period': 'false',
                },
                {
                    'quantity': '1',
                    'product_id': product_id,
                    'transaction_id': transaction_id_2,
                    'original_transaction_id': external_recurring_id,
                    'purchase_date': '2020-01-24 14:42:37 Etc/GMT',
                    'purchase_date_ms': '1579876957000',
                    'purchase_date_pst': '2020-01-24 06:42:37 America/Los_Angeles',
                    'original_purchase_date': '2020-01-21 17:23:56 Etc/GMT',
                    'original_purchase_date_ms': '1579627436000',
                    'original_purchase_date_pst': '2020-01-21 09:23:56 America/Los_Angeles',
                    'expires_date': '2020-01-24 14:47:37 Etc/GMT',
                    'expires_date_ms': expires_at,
                    'expires_date_pst': '2020-01-24 06:47:37 America/Los_Angeles',
                    'web_order_line_item_id': '1000000049781874',
                    'is_trial_period': 'false',
                    'is_in_intro_offer_period': 'false',
                },
            ],
        },
        'latest_receipt_info': [
            {
                'quantity': '1',
                'product_id': product_id,
                'transaction_id': transaction_id_1,
                'original_transaction_id': external_recurring_id,
                'purchase_date': '2020-01-21 17:23:54 Etc/GMT',
                'purchase_date_ms': '1579627434000',
                'purchase_date_pst': '2020-01-21 09:23:54 America/Los_Angeles',
                'original_purchase_date': '2020-01-21 17:23:56 Etc/GMT',
                'original_purchase_date_ms': '1579627436000',
                'original_purchase_date_pst': '2020-01-21 09:23:56 America/Los_Angeles',
                'expires_date': '2020-01-21 17:28:54 Etc/GMT',
                'expires_date_ms': expires_at,
                'expires_date_pst': '2020-01-21 09:28:54 America/Los_Angeles',
                'web_order_line_item_id': '1000000049717223',
                'is_trial_period': 'false',
                'is_in_intro_offer_period': 'false',
                'subscription_group_identifier': '12452',
            },
            {
                'quantity': '1',
                'product_id': product_id,
                'transaction_id': transaction_id_2,
                'original_transaction_id': external_recurring_id,
                'purchase_date': '2020-01-24 15:07:37 Etc/GMT',
                'purchase_date_ms': '1579878457000',
                'purchase_date_pst': '2020-01-24 07:07:37 America/Los_Angeles',
                'original_purchase_date': '2020-01-21 17:23:56 Etc/GMT',
                'original_purchase_date_ms': '1579627436000',
                'original_purchase_date_pst': '2020-01-21 09:23:56 America/Los_Angeles',
                'expires_date': '2020-01-24 17:28:54 Etc/GMT',
                'expires_date_ms': expires_at,
                'expires_date_pst': '2020-01-24 07:12:37 America/Los_Angeles',
                'web_order_line_item_id': '1000000049788697',
                'is_trial_period': 'false',
                'is_in_intro_offer_period': 'false',
                'subscription_group_identifier': '12452',
            },
        ],
        'latest_receipt': 'mocked',
        'pending_renewal_info': [
            {
                'expiration_intent': '1',
                'auto_renew_product_id': product_id,
                'original_transaction_id': external_recurring_id,
                'is_in_billing_retry_period': '0',
                'product_id': product_id,
                'auto_renew_status': auto_renew_status,
            }
        ],
    }


def apple_receipt_validation_response_resubscription():
    return {
        'status': 0,
        'environment': 'Production',
        'receipt': {
            'receipt_type': 'Production',
            'adam_id': 1160922922,
            'app_item_id': 1160922922,
            'bundle_id': 'io.amuse.ios',
            'application_version': '1911',
            'download_id': 37066271787783,
            'version_external_identifier': 836170834,
            'receipt_creation_date': '2020-06-04 22:55:04 Etc/GMT',
            'receipt_creation_date_ms': '1591311304000',
            'receipt_creation_date_pst': '2020-06-04 15:55:04 America/Los_Angeles',
            'request_date': '2020-06-09 07:27:36 Etc/GMT',
            'request_date_ms': '1591687656090',
            'request_date_pst': '2020-06-09 00:27:36 America/Los_Angeles',
            'original_purchase_date': '2019-12-19 05:12:26 Etc/GMT',
            'original_purchase_date_ms': '1576732346000',
            'original_purchase_date_pst': '2019-12-18 21:12:26 America/Los_Angeles',
            'original_application_version': '954',
            'in_app': [
                {
                    'quantity': '1',
                    'product_id': 'amuse_pro_yearly_renewal',
                    'transaction_id': '170000736612291',
                    'original_transaction_id': '170000736612291',
                    'purchase_date': '2020-03-09 14:44:26 Etc/GMT',
                    'purchase_date_ms': '1583765066000',
                    'purchase_date_pst': '2020-03-09 07:44:26 America/Los_Angeles',
                    'original_purchase_date': '2020-03-09 14:44:26 Etc/GMT',
                    'original_purchase_date_ms': '1583765066000',
                    'original_purchase_date_pst': '2020-03-09 07:44:26 America/Los_Angeles',
                    'expires_date': '2020-04-09 14:44:26 Etc/GMT',
                    'expires_date_ms': '1586443466000',
                    'expires_date_pst': '2020-04-09 07:44:26 America/Los_Angeles',
                    'web_order_line_item_id': '170000264591161',
                    'is_trial_period': 'true',
                    'is_in_intro_offer_period': 'false',
                },
                {
                    'quantity': '1',
                    'product_id': 'amuse_pro_monthly_renewal_notrials',
                    'transaction_id': '170000785326185',
                    'original_transaction_id': '170000782611101',
                    'purchase_date': '2020-06-03 18:31:31 Etc/GMT',
                    'purchase_date_ms': '1591209091000',
                    'purchase_date_pst': '2020-06-03 11:31:31 America/Los_Angeles',
                    'original_purchase_date': '2020-05-30 06:20:49 Etc/GMT',
                    'original_purchase_date_ms': '1590819649000',
                    'original_purchase_date_pst': '2020-05-29 23:20:49 America/Los_Angeles',
                    'expires_date': '2020-07-03 18:31:31 Etc/GMT',
                    'expires_date_ms': '1593801091000',
                    'expires_date_pst': '2020-07-03 11:31:31 America/Los_Angeles',
                    'web_order_line_item_id': '170000292390948',
                    'is_trial_period': 'false',
                    'is_in_intro_offer_period': 'false',
                },
                {
                    'quantity': '1',
                    'product_id': 'amuse_pro_yearly_renewal_notrials',
                    'transaction_id': '170000782611101',
                    'original_transaction_id': '170000782611101',
                    'purchase_date': '2020-05-30 06:20:49 Etc/GMT',
                    'purchase_date_ms': '1590819649000',
                    'purchase_date_pst': '2020-05-29 23:20:49 America/Los_Angeles',
                    'original_purchase_date': '2020-05-30 06:20:49 Etc/GMT',
                    'original_purchase_date_ms': '1590819649000',
                    'original_purchase_date_pst': '2020-05-29 23:20:49 America/Los_Angeles',
                    'expires_date': '2021-05-30 06:20:49 Etc/GMT',
                    'expires_date_ms': '1622355649000',
                    'expires_date_pst': '2021-05-29 23:20:49 America/Los_Angeles',
                    'cancellation_date': '2020-06-01 02:33:53 Etc/GMT',
                    'cancellation_date_ms': '1590978833000',
                    'cancellation_date_pst': '2020-05-31 19:33:53 America/Los_Angeles',
                    'web_order_line_item_id': '170000291661129',
                    'is_trial_period': 'false',
                    'is_in_intro_offer_period': 'false',
                    'cancellation_reason': '1',
                },
                {
                    'quantity': '1',
                    'product_id': 'amuse_pro_monthly_renewal_notrials',
                    'transaction_id': '170000784064030',
                    'original_transaction_id': '170000782611101',
                    'purchase_date': '2020-06-01 16:02:57 Etc/GMT',
                    'purchase_date_ms': '1591027377000',
                    'purchase_date_pst': '2020-06-01 09:02:57 America/Los_Angeles',
                    'original_purchase_date': '2020-05-30 06:20:49 Etc/GMT',
                    'original_purchase_date_ms': '1590819649000',
                    'original_purchase_date_pst': '2020-05-29 23:20:49 America/Los_Angeles',
                    'expires_date': '2020-07-01 16:02:57 Etc/GMT',
                    'expires_date_ms': '1593619377000',
                    'expires_date_pst': '2020-07-01 09:02:57 America/Los_Angeles',
                    'cancellation_date': '2020-06-02 13:09:45 Etc/GMT',
                    'cancellation_date_ms': '1591103385000',
                    'cancellation_date_pst': '2020-06-02 06:09:45 America/Los_Angeles',
                    'web_order_line_item_id': '170000291661130',
                    'is_trial_period': 'false',
                    'is_in_intro_offer_period': 'false',
                    'cancellation_reason': '1',
                },
            ],
        },
        'latest_receipt_info': [
            {
                'quantity': '1',
                'product_id': 'amuse_pro_monthly_renewal',
                'transaction_id': '170000786572785',
                'original_transaction_id': '170000782611101',
                'purchase_date': '2020-06-05 22:45:52 Etc/GMT',
                'purchase_date_ms': '1591397152000',
                'purchase_date_pst': '2020-06-05 15:45:52 America/Los_Angeles',
                'original_purchase_date': '2020-05-30 06:20:49 Etc/GMT',
                'original_purchase_date_ms': '1590819649000',
                'original_purchase_date_pst': '2020-05-29 23:20:49 America/Los_Angeles',
                'expires_date': '2020-07-05 22:45:52 Etc/GMT',
                'expires_date_ms': '1593989152000',
                'expires_date_pst': '2020-07-05 15:45:52 America/Los_Angeles',
                'web_order_line_item_id': '170000293129716',
                'is_trial_period': 'false',
                'is_in_intro_offer_period': 'false',
                'subscription_group_identifier': '20581044',
            },
            {
                'quantity': '1',
                'product_id': 'amuse_pro_monthly_renewal_notrials',
                'transaction_id': '170000785326185',
                'original_transaction_id': '170000782611101',
                'purchase_date': '2020-06-03 18:31:31 Etc/GMT',
                'purchase_date_ms': '1591209091000',
                'purchase_date_pst': '2020-06-03 11:31:31 America/Los_Angeles',
                'original_purchase_date': '2020-05-30 06:20:49 Etc/GMT',
                'original_purchase_date_ms': '1590819649000',
                'original_purchase_date_pst': '2020-05-29 23:20:49 America/Los_Angeles',
                'expires_date': '2020-07-03 18:31:31 Etc/GMT',
                'expires_date_ms': '1593801091000',
                'expires_date_pst': '2020-07-03 11:31:31 America/Los_Angeles',
                'cancellation_date': '2020-06-05 22:45:53 Etc/GMT',
                'cancellation_date_ms': '1591397153000',
                'cancellation_date_pst': '2020-06-05 15:45:53 America/Los_Angeles',
                'web_order_line_item_id': '170000292390948',
                'is_trial_period': 'false',
                'is_in_intro_offer_period': 'false',
                'cancellation_reason': '0',
                'subscription_group_identifier': '20581044',
                'is_upgraded': 'true',
            },
            {
                'quantity': '1',
                'product_id': 'amuse_pro_monthly_renewal_notrials',
                'transaction_id': '170000784064030',
                'original_transaction_id': '170000782611101',
                'purchase_date': '2020-06-01 16:02:57 Etc/GMT',
                'purchase_date_ms': '1591027377000',
                'purchase_date_pst': '2020-06-01 09:02:57 America/Los_Angeles',
                'original_purchase_date': '2020-05-30 06:20:49 Etc/GMT',
                'original_purchase_date_ms': '1590819649000',
                'original_purchase_date_pst': '2020-05-29 23:20:49 America/Los_Angeles',
                'expires_date': '2020-07-01 16:02:57 Etc/GMT',
                'expires_date_ms': '1593619377000',
                'expires_date_pst': '2020-07-01 09:02:57 America/Los_Angeles',
                'cancellation_date': '2020-06-02 13:09:45 Etc/GMT',
                'cancellation_date_ms': '1591103385000',
                'cancellation_date_pst': '2020-06-02 06:09:45 America/Los_Angeles',
                'web_order_line_item_id': '170000291661130',
                'is_trial_period': 'false',
                'is_in_intro_offer_period': 'false',
                'cancellation_reason': '1',
                'subscription_group_identifier': '20581044',
            },
            {
                'quantity': '1',
                'product_id': 'amuse_pro_yearly_renewal_notrials',
                'transaction_id': '170000782611101',
                'original_transaction_id': '170000782611101',
                'purchase_date': '2020-05-30 06:20:49 Etc/GMT',
                'purchase_date_ms': '1590819649000',
                'purchase_date_pst': '2020-05-29 23:20:49 America/Los_Angeles',
                'original_purchase_date': '2020-05-30 06:20:49 Etc/GMT',
                'original_purchase_date_ms': '1590819649000',
                'original_purchase_date_pst': '2020-05-29 23:20:49 America/Los_Angeles',
                'expires_date': '2021-05-30 06:20:49 Etc/GMT',
                'expires_date_ms': '1622355649000',
                'expires_date_pst': '2021-05-29 23:20:49 America/Los_Angeles',
                'cancellation_date': '2020-06-01 02:33:53 Etc/GMT',
                'cancellation_date_ms': '1590978833000',
                'cancellation_date_pst': '2020-05-31 19:33:53 America/Los_Angeles',
                'web_order_line_item_id': '170000291661129',
                'is_trial_period': 'false',
                'is_in_intro_offer_period': 'false',
                'cancellation_reason': '1',
                'subscription_group_identifier': '20581044',
            },
            {
                'quantity': '1',
                'product_id': 'amuse_pro_yearly_renewal',
                'transaction_id': '170000736612291',
                'original_transaction_id': '170000736612291',
                'purchase_date': '2020-03-09 14:44:26 Etc/GMT',
                'purchase_date_ms': '1583765066000',
                'purchase_date_pst': '2020-03-09 07:44:26 America/Los_Angeles',
                'original_purchase_date': '2020-03-09 14:44:26 Etc/GMT',
                'original_purchase_date_ms': '1583765066000',
                'original_purchase_date_pst': '2020-03-09 07:44:26 America/Los_Angeles',
                'expires_date': '2020-04-09 14:44:26 Etc/GMT',
                'expires_date_ms': '1586443466000',
                'expires_date_pst': '2020-04-09 07:44:26 America/Los_Angeles',
                'web_order_line_item_id': '170000264591161',
                'is_trial_period': 'true',
                'is_in_intro_offer_period': 'false',
                'subscription_group_identifier': '20581044',
            },
        ],
        'latest_receipt': 'mocked',
        'pending_renewal_info': [
            {
                'auto_renew_product_id': 'amuse_pro_monthly_renewal',
                'original_transaction_id': '170000782611101',
                'product_id': 'amuse_pro_monthly_renewal',
                'auto_renew_status': '0',
            },
            {
                'expiration_intent': '1',
                'auto_renew_product_id': 'amuse_pro_yearly_renewal',
                'original_transaction_id': '170000736612291',
                'is_in_billing_retry_period': '0',
                'product_id': 'amuse_pro_yearly_renewal',
                'auto_renew_status': '0',
            },
        ],
    }
